<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VHF/SDR Control - Tactical Dashboard</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <style>
        .sdr-container {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        @media (max-width: 1200px) {
            .sdr-container {
                grid-template-columns: 1fr;
            }
        }
        .frequency-panel {
            background: linear-gradient(135deg, #111633 0%, #1A1F3A 100%);
            border: 2px solid #2196F3;
            border-radius: 4px;
            padding: 20px;
            box-shadow: 0 0 20px rgba(33, 150, 243, 0.3);
        }
        .frequency-display {
            background: #000;
            border: 2px solid #2196F3;
            border-radius: 4px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: inset 0 0 10px rgba(33, 150, 243, 0.2);
        }
        .frequency-value {
            font-size: 48px;
            font-weight: bold;
            font-family: 'Courier New', monospace;
            color: #2196F3;
            text-shadow: 0 0 10px #2196F3;
            margin: 0;
            line-height: 1.2;
        }
        .frequency-unit {
            font-size: 18px;
            color: #AAA;
            margin-top: 5px;
        }
        .control-group {
            margin: 15px 0;
        }
        .control-label {
            display: block;
            color: #2196F3;
            font-size: 12px;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: bold;
        }
        .frequency-input {
            width: 100%;
            padding: 10px;
            background: rgba(33, 150, 243, 0.1);
            border: 2px solid #2196F3;
            color: #2196F3;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            border-radius: 3px;
            box-sizing: border-box;
        }
        .frequency-input:focus {
            outline: none;
            box-shadow: 0 0 15px rgba(33, 150, 243, 0.5);
        }
        .frequency-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin: 10px 0;
        }
        .freq-btn {
            padding: 10px;
            background: rgba(33, 150, 243, 0.2);
            border: 1px solid #2196F3;
            color: #2196F3;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 3px;
            transition: all 0.2s;
        }
        .freq-btn:hover {
            background: rgba(33, 150, 243, 0.4);
            box-shadow: 0 0 10px rgba(33, 150, 243, 0.5);
        }
        .mode-selector {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin: 10px 0;
        }
        .mode-btn {
            padding: 10px;
            background: rgba(33, 150, 243, 0.1);
            border: 2px solid #2196F3;
            color: #2196F3;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 3px;
            transition: all 0.2s;
        }
        .mode-btn.active {
            background: #2196F3;
            color: #000;
            box-shadow: 0 0 15px rgba(33, 150, 243, 0.6);
        }
        .mode-btn:hover {
            box-shadow: 0 0 10px rgba(33, 150, 243, 0.5);
        }
        .spectrum-display {
            background: linear-gradient(135deg, #111633 0%, #1A1F3A 100%);
            border: 2px solid #2196F3;
            border-radius: 4px;
            padding: 20px;
            margin: 20px 0;
        }
        .spectrum-canvas {
            width: 100%;
            height: 300px;
            background: #000;
            border: 1px solid #2196F3;
            border-radius: 3px;
            margin: 10px 0;
        }
        .signal-meter {
            margin: 20px 0;
        }
        .meter-label {
            color: #2196F3;
            font-size: 12px;
            margin-bottom: 8px;
            text-transform: uppercase;
        }
        .meter-bar {
            width: 100%;
            height: 30px;
            background: #000;
            border: 1px solid #2196F3;
            border-radius: 3px;
            overflow: hidden;
            position: relative;
        }
        .meter-fill {
            height: 100%;
            background: linear-gradient(90deg, #2196F3, #00FF00, #FF8800, #FF1744);
            width: 65%;
            transition: width 0.1s;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 5px;
            color: #000;
            font-weight: bold;
            font-size: 12px;
        }
        .recording-panel {
            background: linear-gradient(135deg, #1A1A00 0%, #2A2A00 100%);
            border: 2px solid #FF8800;
            border-radius: 4px;
            padding: 15px;
            margin: 20px 0;
        }
        .recording-btn {
            width: 100%;
            padding: 15px;
            background: #FF8800;
            color: #000;
            border: none;
            border-radius: 3px;
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .recording-btn:hover {
            box-shadow: 0 0 15px rgba(255, 136, 0, 0.6);
        }
        .recording-btn.active {
            background: #FF1744;
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .info-table {
            width: 100%;
            font-size: 12px;
            color: #AAA;
            border-collapse: collapse;
            margin: 15px 0;
        }
        .info-table td {
            padding: 8px;
            border-bottom: 1px solid rgba(33, 150, 243, 0.1);
        }
        .info-table td:first-child {
            color: #2196F3;
            font-weight: bold;
            width: 40%;
        }
        .info-table td:last-child {
            color: #00FF00;
            text-align: right;
        }
        .preset-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin: 15px 0;
        }
        .preset-btn {
            padding: 12px;
            background: rgba(33, 150, 243, 0.15);
            border: 1px solid #2196F3;
            color: #2196F3;
            font-size: 11px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 3px;
            transition: all 0.2s;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .preset-btn:hover {
            background: rgba(33, 150, 243, 0.3);
            box-shadow: 0 0 8px rgba(33, 150, 243, 0.4);
        }
    </style>
</head>
<body>
    {% if demo_mode %}
    <div class="demo-mode">‚ö† DEMO MODE - No Cluster Connected</div>
    {% endif %}
    <nav class="navbar">
        <div class="nav-brand">‚åò TACTICAL OPS</div>
        <div class="nav-links">
            <a href="/">Dashboard</a>
            <a href="/monitor">Monitor</a>
            <a href="/control">Control</a>
            <a href="/tools">Tools</a>
            <a href="/adsb">ADSB/UAT</a>
            <a href="/mesh">Mesh</a>
            <a href="/vhf" class="active">VHF/SDR</a>
            <a href="/performance">Performance</a>
            <a href="/backup">Backup</a>
            <a href="/settings">Settings</a>
        </div>
        <div class="demo-badge" id="demoBadge" style="display:none;">DEMO MODE</div>
    </nav>
    <main class="container">
        <h1>üìª VHF/SDR FREQUENCY CONTROL</h1>
        <div class="sdr-container">
            <!-- Frequency Control Panel -->
            <div class="frequency-panel">
                <h3 style="margin: 0 0 15px 0; color: #2196F3;">RECEIVER CONTROL</h3>
                <!-- Frequency Display -->
                <div class="frequency-display">
                    <div class="frequency-value" id="frequencyDisplay">146.520</div>
                    <div class="frequency-unit">MHz</div>
                </div>
                <!-- Quick Frequency Input -->
                <div class="control-group">
                    <label class="control-label">Set Frequency</label>
                    <div style="display: flex; gap: 8px;">
                        <input type="text" class="frequency-input" id="frequencyInput" value="146.520" 
                               placeholder="Enter frequency" style="flex: 1;">
                        <button class="btn btn-primary" onclick="setFrequency()" style="padding: 10px 20px;">
                            SET
                        </button>
                    </div>
                </div>
                <!-- Frequency Adjustment Buttons -->
                <div class="control-group">
                    <label class="control-label">Fine Tune</label>
                    <div class="frequency-buttons">
                        <button class="freq-btn" onclick="adjustFrequency(-1)">-1 MHz</button>
                        <button class="freq-btn" onclick="adjustFrequency(-0.1)">-0.1 MHz</button>
                        <button class="freq-btn" onclick="adjustFrequency(0.1)">+0.1 MHz</button>
                        <button class="freq-btn" onclick="adjustFrequency(-0.01)">-10 kHz</button>
                        <button class="freq-btn" onclick="adjustFrequency(0.01)">+10 kHz</button>
                        <button class="freq-btn" onclick="adjustFrequency(1)">+1 MHz</button>
                    </div>
                </div>
                <!-- Mode Selection -->
                <div class="control-group">
                    <label class="control-label">Modulation</label>
                    <div class="mode-selector">
                        <button class="mode-btn active" onclick="setMode(this, 'FM')">FM</button>
                        <button class="mode-btn" onclick="setMode(this, 'AM')">AM</button>
                        <button class="mode-btn" onclick="setMode(this, 'SSB')">SSB</button>
                        <button class="mode-btn" onclick="setMode(this, 'CW')">CW</button>
                    </div>
                </div>
                <!-- Presets -->
                <div class="control-group">
                    <label class="control-label">Saved Frequencies</label>
                    <div class="preset-buttons">
                        <button class="preset-btn" onclick="loadFrequency(146.52)">2M Simplex</button>
                        <button class="preset-btn" onclick="loadFrequency(462.5625)">GMRS 462</button>
                        <button class="preset-btn" onclick="loadFrequency(144.2)">2M Beacon</button>
                        <button class="preset-btn" onclick="loadFrequency(121.5)">Emergency</button>
                    </div>
                </div>
                <!-- Recording Section -->
                <div class="recording-panel">
                    <h4 style="margin: 0 0 10px 0; color: #FF8800;">üéôÔ∏è RECORDING</h4>
                    <button class="recording-btn" id="recordBtn" onclick="toggleRecording()">
                        ‚óè REC
                    </button>
                    <div style="color: #AAA; font-size: 11px; margin-top: 10px; text-align: center;">
                        Duration: <span id="recordDuration" style="color: #FF8800;">--:--</span>
                    </div>
                </div>
            </div>
            <!-- Spectrum Display -->
            <div>
                <!-- Signal Strength Meter -->
                <div class="spectrum-display">
                    <h3 style="margin: 0 0 15px 0; color: #2196F3;">SIGNAL ANALYSIS</h3>
                    
                    <div class="signal-meter">
                        <div class="meter-label">S-Meter (Signal Strength)</div>
                        <div class="meter-bar">
                            <div class="meter-fill" id="sMeter" style="width: 65%;">S 8</div>
                        </div>
                    </div>
                    <!-- Spectrum Canvas -->
                    <div class="meter-label">Frequency Spectrum</div>
                    <canvas id="spectrumCanvas" class="spectrum-canvas"></canvas>
                    <!-- Signal Stats -->
                    <table class="info-table">
                        <tr>
                            <td>Signal Strength</td>
                            <td id="signalStrength">-65 dBm</td>
                        </tr>
                        <tr>
                            <td>Noise Level</td>
                            <td id="noiseLevel">-90 dBm</td>
                        </tr>
                        <tr>
                            <td>SNR</td>
                            <td id="snr">25 dB</td>
                        </tr>
                        <tr>
                            <td>Modulation</td>
                            <td id="modulation">FM</td>
                        </tr>
                        <tr>
                            <td>Bandwidth</td>
                            <td id="bandwidth">12.5 kHz</td>
                        </tr>
                    </table>
                </div>
                <!-- Receiver Info -->
                <div class="spectrum-display">
                    <h3 style="margin: 0 0 15px 0; color: #2196F3;">RECEIVER STATUS</h3>
                    <table class="info-table">
                        <tr>
                            <td>Device</td>
                            <td>RTL-SDR (Generic)</td>
                        </tr>
                        <tr>
                            <td>Tuner</td>
                            <td>Rafael Micro R820T</td>
                        </tr>
                        <tr>
                            <td>Gain</td>
                            <td id="gainValue">37 dB</td>
                        </tr>
                        <tr>
                            <td>Sample Rate</td>
                            <td>2.048 MSPS</td>
                        </tr>
                        <tr>
                            <td>Status</td>
                            <td style="color: #00FF00;">‚óè ACTIVE</td>
                        </tr>
                    </table>
                    <!-- Gain Control -->
                    <div style="margin-top: 20px;">
                        <label class="control-label">Gain Control</label>
                        <input type="range" min="0" max="50" value="37" id="gainControl" 
                               style="width: 100%; cursor: pointer;" onchange="adjustGain(this.value)">
                        <div style="color: #AAA; font-size: 11px; margin-top: 5px; text-align: center;">
                            <span id="gainDisplay">37 dB</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <script>
        let currentFrequency = 146.52;
        let currentMode = 'FM';
        let isRecording = false;
        let recordStartTime = null;
        let recordInterval = null;
        function setFrequency() {
            const input = document.getElementById('frequencyInput');
            const freq = parseFloat(input.value);
            if (isNaN(freq) || freq < 1 || freq > 6000) {
                alert('Invalid frequency. Must be between 1 and 6000 MHz');
                return;
            }
            currentFrequency = freq;
            updateFrequencyDisplay();
        }
        function loadFrequency(freq) {
            currentFrequency = freq;
            document.getElementById('frequencyInput').value = freq;
            updateFrequencyDisplay();
        }
        function adjustFrequency(delta) {
            currentFrequency += delta;
            if (currentFrequency < 1) currentFrequency = 1;
            if (currentFrequency > 6000) currentFrequency = 6000;
            document.getElementById('frequencyInput').value = currentFrequency.toFixed(3);
            updateFrequencyDisplay();
        }
        function updateFrequencyDisplay() {
            document.getElementById('frequencyDisplay').textContent = currentFrequency.toFixed(3);
            // Simulate frequency change effect
            const meter = document.getElementById('sMeter');
            const strength = 50 + Math.random() * 30;
            meter.style.width = strength + '%';
            meter.textContent = 'S ' + Math.round(strength / 10);
        }
        function setMode(button, mode) {
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
            currentMode = mode;
            document.getElementById('modulation').textContent = mode;
        }
        function adjustGain(value) {
            document.getElementById('gainValue').textContent = value + ' dB';
            document.getElementById('gainDisplay').textContent = value + ' dB';
            // Update S-meter with gain adjustment
            const meter = document.getElementById('sMeter');
            const strength = Math.min(100, 30 + (value - 20) * 0.8);
            meter.style.width = strength + '%';
        }
        function toggleRecording() {
            isRecording = !isRecording;
            const btn = document.getElementById('recordBtn');
            const durationSpan = document.getElementById('recordDuration');
            if (isRecording) {
                btn.classList.add('active');
                btn.textContent = '‚èπ STOP REC';
                recordStartTime = Date.now();
                recordInterval = setInterval(() => {
                    const elapsed = Math.floor((Date.now() - recordStartTime) / 1000);
                    const minutes = Math.floor(elapsed / 60);
                    const seconds = elapsed % 60;
                    durationSpan.textContent = 
                        String(minutes).padStart(2, '0') + ':' + 
                        String(seconds).padStart(2, '0');
                }, 100);
            } else {
                btn.classList.remove('active');
                btn.textContent = '‚óè REC';
                clearInterval(recordInterval);
                const elapsed = Math.floor((Date.now() - recordStartTime) / 1000);
                alert(`üìÅ Recording saved (${elapsed} seconds)`);
                durationSpan.textContent = '--:--';
            }
        }
        function drawSpectrum() {
            const canvas = document.getElementById('spectrumCanvas');
            const ctx = canvas.getContext('2d');
            // Clear canvas
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            // Draw frequency axis
            ctx.strokeStyle = 'rgba(33, 150, 243, 0.3)';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 10; i++) {
                const x = (canvas.width / 10) * i;
                ctx.beginPath();
                ctx.moveTo(x, canvas.height - 30);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
                ctx.fillStyle = '#2196F3';
                ctx.font = '10px Courier New';
                ctx.textAlign = 'center';
                ctx.fillText((currentFrequency - 5 + i) + ' MHz', x, canvas.height - 5);
            }
            // Draw spectrum data
            ctx.strokeStyle = '#00FF00';
            ctx.lineWidth = 2;
            ctx.beginPath();
            for (let x = 0; x < canvas.width; x += 2) {
                const progress = x / canvas.width;
                const noise = Math.sin(progress * Math.PI * 2) * 20 + 40;
                const signal = progress > 0.4 && progress < 0.6 ? 80 : 0;
                const y = canvas.height - 30 - (noise + signal) / 100 * (canvas.height - 30);
                if (x === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.stroke();
            // Draw baseline
            ctx.strokeStyle = 'rgba(33, 150, 243, 0.2)';
            ctx.beginPath();
            ctx.moveTo(0, canvas.height - 30);
            ctx.lineTo(canvas.width, canvas.height - 30);
            ctx.stroke();
        }
        // Initialize
        function init() {
            updateFrequencyDisplay();
            drawSpectrum();
            // Redraw spectrum periodically
            setInterval(drawSpectrum, 100);
        }
        init();
    </script>
</body>
</html>
